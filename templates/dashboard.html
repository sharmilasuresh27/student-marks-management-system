<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Class {{ teacher_class }}</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-brand">
                ğŸ“ School Management System
            </div>
            <div class="nav-links">
                <a href="/dashboard" class="nav-link">ğŸ“Š Dashboard</a>
                <a href="/" class="nav-link">ğŸ‘¥ Students</a>
                <a href="/class-toppers" class="nav-link">ğŸ† Class Toppers</a>
                <a href="/school-topper" class="nav-link">ğŸ¥‡ School Topper</a>
                <a href="/weak-students" class="nav-link">âš ï¸ Weak Students</a>
                <a href="/all-classes" class="nav-link">ğŸ“š All Classes</a>
                <a href="/analytics" class="nav-link">ğŸ“ˆ Analytics</a>
                <a href="/attendance" class="nav-link">ğŸ“… Attendance</a>
                <a href="/attendance-calendar" class="nav-link">ğŸ“… Calendar</a>
                <a href="/perfect-attendance" class="nav-link">ğŸ† Perfect Attendance</a>
                <a href="/logout" class="nav-link logout-btn">ğŸšª Logout</a>
            </div>
        </nav>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'success' if category == 'success' else 'error' if category == 'error' else 'info' }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Welcome Section -->
        <div class="card">
            <div class="card-header">
                <h1 class="card-title">Welcome to Class {{ teacher_class }} Dashboard</h1>
                <span class="badge badge-success">{{ session.teacher_name }}</span>
            </div>
            <p style="color: #666; font-size: 16px;">
                Manage your class students, track performance, and monitor academic progress.
            </p>
        </div>

        <!-- Statistics Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" style="color: #667eea;">{{ total_students }}</div>
                <div class="stat-label">Total Students</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" style="color: #00b894;">{{ passed_students }}</div>
                <div class="stat-label">Passed Students</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" style="color: #ff6b6b;">{{ failed_students }}</div>
                <div class="stat-label">Failed Students</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" style="color: #fdcb6e;">
                    {% if total_students > 0 %}
                        {{ ((passed_students / total_students) * 100)|round(1) }}%
                    {% else %}
                        0%
                    {% endif %}
                </div>
                <div class="stat-label">Pass Percentage</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" style="color: #6c5ce7;">{{ perfect_attendance_count }}</div>
                <div class="stat-label">ğŸ† Perfect Attendance</div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
            <!-- Class Topper -->
            <div class="card class-{{ teacher_class.lower() }}">
                <div class="card-header">
                    <h2 class="card-title">ğŸ† Class Topper</h2>
                </div>
                {% if class_topper %}
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 48px; margin-bottom: 10px;">ğŸ¥‡</div>
                        <h3 style="color: #333; margin-bottom: 10px;">{{ class_topper['name'] }}</h3>
                        <p style="color: #666; margin-bottom: 5px;">
                            <strong>Student ID:</strong> {{ class_topper['student_id'] }}
                        </p>
                        <p style="color: #666; margin-bottom: 5px;">
                            <strong>Total Marks:</strong> {{ class_topper['total'] }}/500
                        </p>
                        <p style="color: #666; margin-bottom: 5px;">
                            <strong>Average:</strong> {{ "%.1f"|format(class_topper['average']) }}
                        </p>
                        <p style="color: #666;">
                            <strong>Grade:</strong> 
                            <span class="grade-{{ class_topper['grade'].lower().replace('+', '-plus') }}">{{ class_topper['grade'] }}</span>
                        </p>
                        <div style="margin-top: 15px;">
                            <span class="badge badge-success">{{ class_topper['status'] }}</span>
                        </div>
                    </div>
                {% else %}
                    <div style="text-align: center; padding: 40px; color: #999;">
                        <div style="font-size: 48px; margin-bottom: 10px;">ğŸ“</div>
                        <p>No students added yet</p>
                        <a href="/" class="btn btn-primary">Add First Student</a>
                    </div>
                {% endif %}
            </div>

            <!-- Recent Students -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">ğŸ“ Recent Students</h2>
                    <a href="/" class="btn btn-primary btn-sm">View All</a>
                </div>
                {% if recent_students %}
                    <div style="max-height: 300px; overflow-y: auto;">
                        {% for student in recent_students %}
                            <div style="padding: 15px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-weight: 600; color: #333;">{{ student['name'] }}</div>
                                    <div style="color: #666; font-size: 14px;">{{ student['student_id'] }}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-weight: 600; color: #667eea;">{{ student['total'] }}</div>
                                    <span class="badge badge-{{ 'success' if student['status'] == 'PASS' else 'danger' }}">
                                        {{ student['status'] }}
                                    </span>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div style="text-align: center; padding: 40px; color: #999;">
                        <p>No students added yet</p>
                        <a href="/" class="btn btn-primary">Add Student</a>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">âš¡ Quick Actions</h2>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <a href="/" class="btn btn-primary" style="text-align: center; justify-content: center;">
                    â• Add New Student
                </a>
                <a href="/weak-students" class="btn btn-warning" style="text-align: center; justify-content: center;">
                    âš ï¸ View Weak Students
                </a>
                <a href="/class-toppers" class="btn btn-success" style="text-align: center; justify-content: center;">
                    ğŸ† View Toppers
                </a>
                <a href="/all-classes" class="btn btn-primary" style="text-align: center; justify-content: center;">
                    ğŸ“Š All Classes View
                </a>
            </div>
        </div>
    </div>

    <script>
        // Add some interactivity
        document.addEventListener('DOMContentLoaded', function() {
            // Animate stat cards on scroll
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.animation = 'fadeIn 0.5s ease forwards';
                    }
                });
            });

            document.querySelectorAll('.stat-card').forEach(card => {
                observer.observe(card);
            });
        });
    </script>
</body>
</html>

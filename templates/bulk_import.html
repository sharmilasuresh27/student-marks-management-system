<!DOCTYPE html>
<html lang="en" data-theme="{{ session.get('theme', 'light') }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulk Import - School Management</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <!-- Theme Switcher -->
    <div class="theme-switcher">
        <button class="theme-toggle" onclick="toggleTheme('light')" title="Light Mode">
            â˜€ï¸
        </button>
        <button class="theme-toggle" onclick="toggleTheme('dark')" title="Dark Mode">
            ğŸŒ™
        </button>
    </div>

    <div class="container">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-brand">
                ğŸ“ School Management System
            </div>
            <div class="nav-links">
                <a href="/dashboard" class="nav-link">ğŸ“Š Dashboard</a>
                <a href="/" class="nav-link">ğŸ‘¥ Students</a>
                <a href="/class-toppers" class="nav-link">ğŸ† Class Toppers</a>
                <a href="/school-topper" class="nav-link">ğŸ¥‡ School Topper</a>
                <a href="/weak-students" class="nav-link">âš ï¸ Weak Students</a>
                <a href="/all-classes" class="nav-link">ğŸ“š All Classes</a>
                <a href="/analytics" class="nav-link">ğŸ“ˆ Analytics</a>
                <a href="/logout" class="nav-link logout-btn">ğŸšª Logout</a>
            </div>
        </nav>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'success' if category == 'success' else 'error' if category == 'error' else 'info' }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Header -->
        <div class="card">
            <div class="card-header">
                <h1 class="card-title">ğŸ“¥ Bulk Import Students</h1>
                <span class="badge badge-success">CSV Import Ready</span>
            </div>
            <p style="color: #666; font-size: 16px;">
                Import multiple students at once using CSV files. Supports automatic validation and error reporting.
            </p>
        </div>

        <!-- Upload Form -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ï¿½ Upload CSV File</h2>
            </div>
            
            <form action="/bulk-import" method="POST" enctype="multipart/form-data" style="padding: 20px;">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #333;">
                        Select CSV File:
                    </label>
                    <input type="file" name="file" accept=".csv" required 
                           style="padding: 10px; border: 2px solid #ddd; border-radius: 5px; width: 100%;">
                </div>
                
                <button type="submit" class="btn btn-primary" style="padding: 12px 30px; font-size: 16px;">
                    ğŸ“¥ Import Students
                </button>
            </form>
        </div>

        <!-- CSV Format Instructions -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ğŸ“‹ CSV Format Instructions</h2>
            </div>
            <div style="padding: 20px;">
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; font-family: monospace; font-size: 14px; margin-bottom: 20px;">
                    <strong>Required CSV Format:</strong><br>
                    name,tamil,english,maths,science,social<br><br>
                    <strong>Example:</strong><br>
                    John Doe,85,78,92,88,76<br>
                    Jane Smith,92,85,78,90,82<br>
                    Bob Johnson,78,92,85,76,88
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <div>
                        <h4 style="color: #333; margin-bottom: 10px;">ğŸ“ File Requirements:</h4>
                        <ul style="color: #666; line-height: 1.8;">
                            <li>File must be in CSV format (.csv extension)</li>
                            <li>First row should contain headers: name,tamil,english,maths,science,social</li>
                            <li>Each subsequent row represents one student</li>
                            <li>Name should be in quotes if it contains spaces</li>
                            <li>All marks should be numbers between 0-100</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 style="color: #333; margin-bottom: 10px;">âœ… Validation Rules:</h4>
                        <ul style="color: #666; line-height: 1.8;">
                            <li>Invalid marks (outside 0-100 range) will be skipped</li>
                            <li>Rows with missing data will be skipped</li>
                            <li>Valid students will be automatically added to your class</li>
                            <li>Student IDs will be generated automatically</li>
                            <li>Grades and status will be calculated automatically</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sample Download -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ï¿½ Download Sample CSV</h2>
            </div>
            
            <div style="padding: 20px; text-align: center;">
                <p style="color: #666; margin-bottom: 15px;">
                    Download a sample CSV file to see the exact format required:
                </p>
                
                <a href="data:text/csv;charset=utf-8,name,tamil,english,maths,science,social%0AJohn Doe,85,78,92,88,76%0AJane Smith,92,85,78,90,82%0ABob Johnson,78,92,85,76,88" 
                   download="sample_students.csv" 
                   class="btn btn-success" style="padding: 12px 25px; font-size: 16px; text-decoration: none;">
                    ğŸ“¥ Download Sample CSV
                </a>
            </div>
        </div>

        <!-- Back Button -->
        <div class="card">
            <div style="padding: 20px; text-align: center;">
                <a href="/" class="btn btn-primary" style="font-size: 18px; padding: 15px 30px;">
                    ğŸ‘¥ Back to Student Management
                </a>
            </div>
        </div>
    </div>

    <script>
        // Theme Toggle Function
        function toggleTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            
            // Save theme preference to session
            fetch('/toggle-theme', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'theme=' + theme
            }).then(response => response.json())
              .then(data => {
                console.log('Theme changed to:', data.theme);
              });
        }

        // Load saved theme on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        });
    </script>
</body>
</html>
